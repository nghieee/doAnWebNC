@model dynamic

@{
    string title = Model.Title;
    var categories = Model.Categories as IEnumerable<web_ban_thuoc.Models.Category>;
    var jsFunc = "showSubCategories_" + title.Replace(" ", "");
    var jsId = "subCategoryItems-" + title.Replace(" ", "");
    var jsCategories = categories != null
        ? System.Text.Json.JsonSerializer.Serialize(
            categories.Select(c => new {
                id = c.CategoryId,
                children = c.InverseParentCategory.Select(sub => new {
                    name = sub.CategoryName,
                    image = sub.ImageUrl
                })
            }).ToList()
        )
        : "[]";
}

<div class="dropdown position-static d-inline-block">
    <button class="btn btn-link text-decoration-none text-sm font-medium py-3 d-flex align-items-center gap-1 position-relative transition-colors"
            type="button">
        @title
        <i class="fas fa-chevron-down transition-transform" style="transition-duration: 0.3s;"></i>
    </button>
    <div class="dropdown-menu show w-auto shadow-lg border rounded-4 p-0 mt-2" style="min-width:600px; left:0;">
        <div class="d-flex">
            <!-- Cột trái: Danh mục cấp 2 -->
            <div class="w-25 p-3 border-end" style="min-width:200px;">
                @if (categories != null && categories.Any())
                {
                    foreach (var cat in categories)
                    {
                        <div class="d-flex align-items-center gap-2 px-3 py-2 rounded-lg cursor-pointer text-dark hover-bg-light menu-cat2-item"
                             data-cat-id="@cat.CategoryId"
                             onmouseenter="@($"{jsFunc}({cat.CategoryId})")">
                            <img src="@cat.ImageUrl" alt="@cat.CategoryName" width="24" height="24" class="object-contain" />
                            <span>@cat.CategoryName</span>
                        </div>
                    }
                }
                else
                {
                    <div class="text-muted">Không có danh mục con</div>
                }
            </div>
            <!-- Cột phải: Danh mục cấp 3 -->
            <div class="w-75 p-3" id="@jsId">
                <div class="text-gray-500">Di chuột vào danh mục để xem danh mục con</div>
            </div>
        </div>
    </div>
</div>

<script>
    // Dynamically declare the function with the correct name
    window['@jsFunc'] = function(catId) {
        const categories = @Html.Raw(jsCategories);
        const cat = categories.find(c => c.id === catId);
        const container = document.getElementById('@jsId');
        if (cat && cat.children.length > 0) {
            container.innerHTML = cat.children.map(sub =>
                `<div class="d-flex align-items-center gap-2 p-2 bg-light rounded-lg mb-2">
                    <img src="${sub.image}" alt="${sub.name}" width="24" height="24" />
                    <span>${sub.name}</span>
                </div>`
            ).join('');
        } else {
            container.innerHTML = `<div class="text-gray-500">Không có danh mục con</div>`;
        }
    }
</script>